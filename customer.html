<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Customer Store - Delivery System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#fef2f2",
                100: "#fee2e2",
                200: "#fecaca",
                300: "#fca5a5",
                400: "#f87171",
                500: "#ef4444",
                600: "#dc2626",
                700: "#b91c1c",
                800: "#991b1b",
                900: "#7f1d1d",
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b sticky top-0 z-40">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center">
            <button
              onclick="window.location.href='index.html'"
              class="flex items-center text-gray-600 hover:text-gray-900 mr-4"
            >
              <svg
                class="h-5 w-5 mr-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                ></path>
              </svg>
              Back
            </button>
            <h1 class="text-xl font-bold text-gray-900">Our Menu</h1>
          </div>

          <!-- Cart Button -->
          <button
            onclick="toggleCart()"
            class="relative bg-primary-500 text-white px-4 py-2 rounded-lg hover:bg-primary-600 flex items-center gap-2"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
              ></path>
            </svg>
            Cart
            <span
              id="cart-count"
              class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center hidden"
              >0</span
            >
          </button>
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Search and Filters -->
      <div class="mb-8 space-y-4">
        <div class="relative">
          <svg
            class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            ></path>
          </svg>
          <input
            type="text"
            id="search-input"
            onkeyup="filterProducts()"
            placeholder="Search for food..."
            class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
          />
        </div>

        <!-- Category Filter -->
        <div id="category-filters" class="flex flex-wrap gap-2">
          <!-- Categories will be loaded dynamically -->
        </div>
      </div>

      <!-- Store Info -->
      <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-900">DeliveryStore</h2>
            <div class="flex items-center gap-4 mt-2 text-sm text-gray-600">
              <div class="flex items-center gap-1">
                <svg
                  class="h-4 w-4 fill-yellow-400 text-yellow-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                  ></path>
                </svg>
                <span>4.5 (500+ reviews)</span>
              </div>
              <div class="flex items-center gap-1">
                <svg
                  class="h-4 w-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                <span>30-45 min delivery</span>
              </div>
              <div class="flex items-center gap-1">
                <svg
                  class="h-4 w-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                  ></path>
                </svg>
                <span>2.5 km away</span>
              </div>
            </div>
          </div>
          <div class="text-right">
            <div
              class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium"
            >
              Open
            </div>
            <p class="text-sm text-gray-600 mt-1">Closes at 11:00 PM</p>
          </div>
        </div>
      </div>

      <!-- Products Grid -->
      <div
        id="products-grid"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
      >
        <div class="text-center py-8 text-gray-500">Loading products...</div>
      </div>

      <div id="no-products" class="text-center py-12 hidden">
        <p class="text-gray-500 text-lg">
          No products found matching your criteria.
        </p>
      </div>
    </div>

    <!-- Cart Modal -->
    <div
      id="cart-modal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white rounded-lg w-full max-w-md max-h-[90vh] overflow-y-auto"
      >
        <div
          class="sticky top-0 bg-white p-4 border-b flex justify-between items-center"
        >
          <h3 class="text-lg font-semibold">Your Cart</h3>
          <button
            onclick="toggleCart()"
            class="p-2 hover:bg-gray-100 rounded-full"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <div class="p-4">
          <div id="cart-items" class="space-y-4 mb-6">
            <p class="text-center text-gray-500 py-8">Your cart is empty</p>
          </div>

          <div id="cart-total" class="border-t pt-4 hidden">
            <div class="flex justify-between items-center mb-4">
              <span class="text-lg font-semibold">Total:</span>
              <span id="total-price" class="text-lg font-bold text-primary-600"
                >$0.00</span
              >
            </div>

            <button
              onclick="proceedToCheckout()"
              class="w-full bg-primary-500 text-white py-3 rounded-lg hover:bg-primary-600 flex items-center justify-center gap-2"
            >
              <svg
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"
                ></path>
              </svg>
              Proceed to Checkout
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div
      id="checkout-modal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white rounded-lg w-full max-w-md max-h-[90vh] overflow-y-auto"
      >
        <div
          class="sticky top-0 bg-white p-4 border-b flex justify-between items-center"
        >
          <h3 class="text-lg font-semibold">Checkout</h3>
          <button
            onclick="closeCheckout()"
            class="p-2 hover:bg-gray-100 rounded-full"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <div class="p-4 space-y-6">
          <!-- Order Summary -->
          <div>
            <h4 class="font-medium mb-3">Order Summary</h4>
            <div id="checkout-items" class="space-y-2 text-sm">
              <!-- Items will be populated here -->
            </div>
          </div>

          <!-- Customer Details -->
          <div>
            <h4 class="font-medium mb-3">Customer Details</h4>
            <input
              type="text"
              id="customer-name"
              placeholder="Full Name"
              class="w-full p-3 border rounded-lg mb-3"
              required
            />
            <input
              type="email"
              id="customer-email"
              placeholder="Email Address"
              class="w-full p-3 border rounded-lg mb-3"
            />
            <input
              type="tel"
              id="customer-phone"
              placeholder="Phone Number"
              class="w-full p-3 border rounded-lg"
            />
          </div>

          <!-- Delivery Address -->
          <div>
            <h4 class="font-medium mb-3 flex items-center gap-2">
              <svg
                class="h-4 w-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                ></path>
              </svg>
              Delivery Address
            </h4>
            <input
              type="text"
              id="delivery-address"
              placeholder="Enter your full address"
              class="w-full p-3 border rounded-lg"
              value="123 Main St, City, State"
              required
            />
          </div>

          <!-- Delivery Time -->
          <div>
            <h4 class="font-medium mb-3 flex items-center gap-2">
              <svg
                class="h-4 w-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              Delivery Time
            </h4>
            <select id="delivery-time" class="w-full p-3 border rounded-lg">
              <option value="ASAP">ASAP (30-45 mins)</option>
              <option value="1:00 PM">1:00 PM - 1:30 PM</option>
              <option value="2:00 PM">2:00 PM - 2:30 PM</option>
              <option value="3:00 PM">3:00 PM - 3:30 PM</option>
            </select>
          </div>

          <!-- Payment Method -->
          <div>
            <h4 class="font-medium mb-3 flex items-center gap-2">
              <svg
                class="h-4 w-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"
                ></path>
              </svg>
              Payment Method
            </h4>
            <div class="space-y-2">
              <label
                class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50"
              >
                <input
                  type="radio"
                  name="payment"
                  value="card"
                  checked
                  class="mr-3"
                />
                Credit/Debit Card
              </label>
              <label
                class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50"
              >
                <input type="radio" name="payment" value="cash" class="mr-3" />
                Cash on Delivery
              </label>
            </div>
          </div>

          <button
            onclick="placeOrder()"
            class="w-full bg-primary-500 text-white py-3 rounded-lg hover:bg-primary-600 font-medium"
          >
            <span id="place-order-text">Place Order - $0.00</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Order Success Modal -->
    <div
      id="success-modal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4"
    >
      <div class="bg-white rounded-lg p-8 text-center max-w-md">
        <div
          class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <svg
            class="h-8 w-8 text-green-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 13l4 4L19 7"
            ></path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-green-600 mb-2">
          Order Placed Successfully!
        </h3>
        <p class="text-gray-600 mb-4">
          Your order is being prepared. You'll receive updates shortly.
        </p>
        <p class="text-sm text-gray-500 mb-4">
          Order ID: <span id="order-id" class="font-mono"></span>
        </p>
        <button
          onclick="closeSuccess()"
          class="bg-primary-500 text-white px-6 py-2 rounded-lg hover:bg-primary-600"
        >
          Continue Shopping
        </button>
      </div>
    </div>

    <script>
      const API_BASE = `${window.location.origin}/api`;
      let products = [];
      let categories = [];
      let cart = [];
      let selectedCategory = "All";

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        loadProducts();
        loadCategories();
      });

      // Load Products
      async function loadProducts() {
        try {
          const response = await fetch(`${API_BASE}/products`);
          const data = await response.json();

          if (data.success) {
            products = data.data;
            displayProducts();
          }
        } catch (error) {
          console.error("Error loading products:", error);
          document.getElementById("products-grid").innerHTML =
            '<div class="text-center py-8 text-red-500">Error loading products. Make sure the backend server is running.</div>';
        }
      }

      // Load Categories
      async function loadCategories() {
        try {
          const response = await fetch(`${API_BASE}/categories`);
          const data = await response.json();

          if (data.success) {
            categories = ["All", ...data.data];
            displayCategories();
          }
        } catch (error) {
          console.error("Error loading categories:", error);
        }
      }

      function displayCategories() {
        const container = document.getElementById("category-filters");
        container.innerHTML = categories
          .map(
            (category) => `
                <button onclick="filterByCategory('${category}')" 
                    data-category="${category}"
                    class="category-btn px-4 py-2 rounded-full text-sm font-medium transition-colors ${
                      category === selectedCategory
                        ? "bg-primary-500 text-white"
                        : "bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"
                    }">
                    ${category}
                </button>
            `
          )
          .join("");
      }

      function filterByCategory(category) {
        selectedCategory = category;
        displayCategories();
        filterProducts();
      }

      function filterProducts() {
        const searchTerm = document
          .getElementById("search-input")
          .value.toLowerCase();

        const filteredProducts = products.filter((product) => {
          const matchesCategory =
            selectedCategory === "All" || product.category === selectedCategory;
          const matchesSearch =
            product.name.toLowerCase().includes(searchTerm) ||
            product.description.toLowerCase().includes(searchTerm);
          return matchesCategory && matchesSearch && product.inStock;
        });

        displayFilteredProducts(filteredProducts);
      }

      function displayProducts() {
        displayFilteredProducts(products.filter((p) => p.inStock));
      }

      function displayFilteredProducts(filteredProducts) {
        const container = document.getElementById("products-grid");
        const noProducts = document.getElementById("no-products");

        if (filteredProducts.length === 0) {
          container.classList.add("hidden");
          noProducts.classList.remove("hidden");
          return;
        }

        container.classList.remove("hidden");
        noProducts.classList.add("hidden");

        container.innerHTML = filteredProducts
          .map(
            (product) => `
                <div class="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow">
                    <img src="${
                      product.image ||
                      "https://via.placeholder.com/400x200?text=No+Image"
                    }" 
                         alt="${product.name}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-lg">${
                              product.name
                            }</h3>
                            <span class="text-lg font-bold text-primary-600">$${product.price.toFixed(
                              2
                            )}</span>
                        </div>
                        
                        <p class="text-gray-600 text-sm mb-3 line-clamp-2">${
                          product.description
                        }</p>
                        
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-2 text-sm">
                                <div class="flex items-center gap-1">
                                    <svg class="h-4 w-4 fill-yellow-400 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                    </svg>
                                    <span>${product.rating || 4.5}</span>
                                </div>
                                <span class="text-gray-400">â€¢</span>
                                <span class="text-gray-600">${
                                  product.reviews || 0
                                } reviews</span>
                            </div>
                            <span class="text-sm bg-gray-100 px-2 py-1 rounded">${
                              product.category
                            }</span>
                        </div>

                        <button onclick="addToCart('${product.id}')" 
                            class="w-full bg-primary-500 text-white py-2 px-4 rounded-lg font-medium hover:bg-primary-600 flex items-center justify-center gap-2">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            Add to Cart
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Cart Management
      function addToCart(productId) {
        const product = products.find((p) => p.id === productId);
        if (!product) return;

        const existingItem = cart.find((item) => item.product.id === productId);
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({ product, quantity: 1 });
        }

        updateCartUI();

        // Show brief feedback
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = "Added!";
        button.classList.add("bg-green-500");
        setTimeout(() => {
          button.innerHTML = originalText;
          button.classList.remove("bg-green-500");
        }, 1000);
      }

      function updateCartQuantity(productId, newQuantity) {
        if (newQuantity <= 0) {
          cart = cart.filter((item) => item.product.id !== productId);
        } else {
          const item = cart.find((item) => item.product.id === productId);
          if (item) {
            item.quantity = newQuantity;
          }
        }
        updateCartUI();
      }

      function updateCartUI() {
        const cartCount = document.getElementById("cart-count");
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

        if (totalItems > 0) {
          cartCount.textContent = totalItems;
          cartCount.classList.remove("hidden");
        } else {
          cartCount.classList.add("hidden");
        }

        updateCartModal();
      }

      function updateCartModal() {
        const cartItems = document.getElementById("cart-items");
        const cartTotal = document.getElementById("cart-total");
        const totalPrice = document.getElementById("total-price");

        if (cart.length === 0) {
          cartItems.innerHTML =
            '<p class="text-center text-gray-500 py-8">Your cart is empty</p>';
          cartTotal.classList.add("hidden");
          return;
        }

        const total = cart.reduce(
          (sum, item) => sum + item.product.price * item.quantity,
          0
        );
        totalPrice.textContent = `$${total.toFixed(2)}`;
        cartTotal.classList.remove("hidden");

        cartItems.innerHTML = cart
          .map(
            (item) => `
                <div class="flex items-center space-x-4 bg-gray-50 p-3 rounded-lg">
                    <img src="${
                      item.product.image ||
                      "https://via.placeholder.com/64x64?text=No+Image"
                    }" 
                         alt="${
                           item.product.name
                         }" class="w-16 h-16 object-cover rounded-lg">
                    <div class="flex-1">
                        <h4 class="font-medium">${item.product.name}</h4>
                        <p class="text-sm text-gray-600">$${item.product.price.toFixed(
                          2
                        )} each</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="updateCartQuantity('${
                          item.product.id
                        }', ${item.quantity - 1})" 
                            class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                            </svg>
                        </button>
                        <span class="w-8 text-center font-medium">${
                          item.quantity
                        }</span>
                        <button onclick="updateCartQuantity('${
                          item.product.id
                        }', ${item.quantity + 1})" 
                            class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function toggleCart() {
        const modal = document.getElementById("cart-modal");
        if (modal.classList.contains("hidden")) {
          modal.classList.remove("hidden");
          modal.classList.add("flex");
          updateCartModal();
        } else {
          modal.classList.add("hidden");
          modal.classList.remove("flex");
        }
      }

      function proceedToCheckout() {
        if (cart.length === 0) return;

        toggleCart(); // Close cart modal

        const modal = document.getElementById("checkout-modal");
        modal.classList.remove("hidden");
        modal.classList.add("flex");

        updateCheckoutModal();
      }

      function updateCheckoutModal() {
        const checkoutItems = document.getElementById("checkout-items");
        const placeOrderText = document.getElementById("place-order-text");

        const total = cart.reduce(
          (sum, item) => sum + item.product.price * item.quantity,
          0
        );

        checkoutItems.innerHTML =
          cart
            .map(
              (item) => `
                <div class="flex justify-between">
                    <span>${item.quantity}x ${item.product.name}</span>
                    <span>$${(item.product.price * item.quantity).toFixed(
                      2
                    )}</span>
                </div>
            `
            )
            .join("") +
          `
                <div class="border-t pt-2 font-semibold flex justify-between">
                    <span>Total:</span>
                    <span>$${total.toFixed(2)}</span>
                </div>
            `;

        placeOrderText.textContent = `Place Order - $${total.toFixed(2)}`;
      }

      function closeCheckout() {
        const modal = document.getElementById("checkout-modal");
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      }

      async function placeOrder() {
        const customerName = document.getElementById("customer-name").value;
        const customerEmail = document.getElementById("customer-email").value;
        const customerPhone = document.getElementById("customer-phone").value;
        const address = document.getElementById("delivery-address").value;
        const deliveryTime = document.getElementById("delivery-time").value;

        if (!customerName || !address) {
          alert("Please fill in all required fields");
          return;
        }

        const orderData = {
          customerName,
          customerEmail,
          customerPhone,
          address,
          deliveryTime,
          items: cart.map((item) => ({
            productId: item.product.id,
            quantity: item.quantity,
            price: item.product.price,
          })),
          total: cart.reduce(
            (sum, item) => sum + item.product.price * item.quantity,
            0
          ),
        };

        try {
          const response = await fetch(`${API_BASE}/orders`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(orderData),
          });

          const result = await response.json();

          if (result.success) {
            closeCheckout();
            showOrderSuccess(result.data.id);
            cart = [];
            updateCartUI();
          } else {
            alert("Error placing order. Please try again.");
          }
        } catch (error) {
          console.error("Error placing order:", error);
          alert(
            "Error placing order. Please check your connection and try again."
          );
        }
      }

      function showOrderSuccess(orderId) {
        document.getElementById("order-id").textContent = orderId;
        const modal = document.getElementById("success-modal");
        modal.classList.remove("hidden");
        modal.classList.add("flex");
      }

      function closeSuccess() {
        const modal = document.getElementById("success-modal");
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      }
    </script>
  </body>
</html>
